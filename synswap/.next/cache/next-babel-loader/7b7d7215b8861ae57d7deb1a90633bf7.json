{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\n\nvar _this = this;\n\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { Grid } from '@material-ui/core';\nimport Tabs, { Tab } from \"react-awesome-tabs\";\nimport \"../resources/styles/react-awesome-tabs.scss\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport nextCookie from 'next-cookies';\nimport Router from 'next/router';\nimport Header from \"../components/main/Header\";\nimport Home from './Home';\nimport NewTrade from './NewTrade';\nimport Trade from './Trade';\nimport Blotter from './Blotter';\nimport FileUpload from './FileUpload';\nimport { error } from \"next/dist/build/output/log\";\nimport axios from \"axios\";\nimport { withAuthSync } from '../utils/Auth/auth';\nimport getHost from '../utils/Auth/get-host';\n/**\n * @class Main\n * @constructor\n * Contains all the navigation functions, including the <Tabs /> and their functions (dispatched to reducers/TabReducer)\n * Dependencies used:\n * @react-awesome-tabs for the <Tabs> and <Tab> components, react-awesome-tabs.scss for styling (comes with module)\n * @material-ui for <Grid />\n * @react-redux for useDispatch and useSelector\n * Custom Components used:\n * @class NewTradeContent - New Trade page\n * @class Home - Home page\n * @class Trade - Trade page\n * @class Header - Header\n */\n\nfunction useInterval(callback, params, delay) {\n  useEffect(function () {\n    setInterval(function () {\n      callback(params);\n    }, delay);\n    return function () {\n      console.log('Component Unmounted');\n    };\n  }, []);\n}\n\nvar Main = function Main() {\n  var blockNumber = useSelector(function (state) {\n    return state.TradeReducer.blockNumber;\n  });\n\n  var initialFetch =\n  /*#__PURE__*/\n  function () {\n    var _ref = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var url, response;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              url = \"http://localhost:4000/api/traders/1/trades\";\n              _context.prev = 1;\n              _context.next = 4;\n              return axios.get(url);\n\n            case 4:\n              response = _context.sent;\n              dispatch({\n                type: 'INITIAL_FETCH',\n                payload: {\n                  trades: response.data.trades,\n                  blocknumber: response.data.blocknumber\n                }\n              });\n              _context.next = 11;\n              break;\n\n            case 8:\n              _context.prev = 8;\n              _context.t0 = _context[\"catch\"](1);\n              console.log(_context.t0);\n\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 8]]);\n    }));\n\n    return function initialFetch() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var fetchTrades =\n  /*#__PURE__*/\n  function () {\n    var _ref2 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2(bn) {\n      var url, response, notifications;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              url = \"http://localhost:4000/api/updates/\" + bn + \"?traderid=1\";\n              _context2.prev = 1;\n              _context2.next = 4;\n              return axios.get(url);\n\n            case 4:\n              response = _context2.sent;\n\n              if (response.data.success && response.data.trades) {\n                dispatch({\n                  type: 'FETCH_TRADES',\n                  payload: {\n                    trades: response.data.trades,\n                    blockNumber: response.data.blocknumber\n                  }\n                });\n                notifications = response.data.trades.map(function (trade) {\n                  // TODO: Only new trade notifcations currently, currently cannot amend trades.\n                  return {\n                    message: \"Amount: \" + trade.amount + \" Type: \" + trade.tradeType,\n                    title: \"New trade with \" + trade.counterPartyId + \" alleged\"\n                  };\n                });\n                dispatch({\n                  type: 'ADD_NOTIFICATIONS',\n                  payload: notifications\n                });\n              }\n\n              _context2.next = 11;\n              break;\n\n            case 8:\n              _context2.prev = 8;\n              _context2.t0 = _context2[\"catch\"](1);\n              console.log(_context2.t0);\n\n            case 11:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[1, 8]]);\n    }));\n\n    return function fetchTrades(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    initialFetch();\n    return;\n  }, []); //useInterval(fetchTrades, blockNumber, 5000);\n\n  /**\n   * @constant activeTab\n   * @type {object}\n   * a number that represents the activeTab piece of state\n   */\n\n  var activeTab = useSelector(function (state) {\n    return state.TabReducer.activeTab;\n  });\n  /**\n   * @var tabs\n   * @type {object}\n   * an array of objects representing the tabs, with each object in the format { title, index, component }\n   */\n\n  var tabs = useSelector(function (state) {\n    return state.TabReducer.tabs;\n  });\n  /**\n   * @constant dispatch\n   * @type {function}\n   * gives access to dispatch function from Redux store\n   */\n\n  var dispatch = useDispatch();\n  /**\n   * @constant MAIN_TABS\n   * @type {array}\n   * array of objects that contains a 'key' and a 'component' that is mapped to the 'component' attribute from a tab object in....\n   * ....matchLink\n   */\n\n  var MAIN_TABS = [{\n    key: 'Home',\n    component: Home({\n      onClick: handleClick.bind(_this)\n    })\n  }, {\n    key: 'NewTrade',\n    component: NewTrade({\n      onClick: handleClick\n    })\n  }, {\n    key: 'Trade',\n    component: Trade()\n  }, {\n    key: 'Blotter',\n    component: Blotter()\n  }, {\n    key: 'FileNewTrade',\n    component: FileUpload()\n  }];\n  /**\n   * @constant openTabs\n   * @type {array}\n   * used in handleClick method to redirect to a tab if it is already open\n   */\n\n  var _useState = useState(['Home']),\n      _useState2 = _slicedToArray(_useState, 2),\n      openTabs = _useState2[0],\n      changeTabs = _useState2[1];\n  /**\n   * @function matchLink\n   * @type string\n   * @param link\n   * helper function that receives a link {string} from an option in the <HomePane />'s (child components of <Home />) and\n   * matches it to a 'component' in the MAIN_TABS array via the 'key'\n   * @return number\n   */\n\n\n  function matchLink(link) {\n    for (var i = 0; i < MAIN_TABS.length; i++) {\n      var data = MAIN_TABS[i];\n\n      if (link === data.key) {\n        return i;\n      }\n    }\n\n    throw Error('Component Not Found');\n  }\n  /**\n   * @function handleTabSwitch\n   * @type number\n   * @type dispatch\n   * @param active\n   * eventHandler helper function that takes the desired tab as a parameter and makes it the new active tab\n   */\n\n\n  function handleTabSwitch(active) {\n    dispatch({\n      type: 'SWITCH_TAB',\n      payload: active\n    });\n  }\n  /**\n   * @function handleTabPositionChange\n   * @type dispatch\n   * @param a\n   * @param b\n   * eventHandler helper function that takes the two tabs to be switched around, switches their indices,...\n   * ...and changes the new active tab\n   */\n\n\n  function handleTabPositionChange(a, b) {\n    var c = tabs[a];\n    tabs[a] = tabs[b];\n    tabs[b] = c;\n\n    if (activeTab === a) {\n      dispatch({\n        type: 'SWITCH_TAB',\n        activeTab: b\n      });\n    } else if (activeTab === b) {\n      dispatch({\n        type: 'SWITCH_TAB',\n        activeTab: a\n      });\n    }\n  }\n  /**\n   * @function handleTabClose\n   * @param index\n   * eventHandler helper function that takes the closed tab and pops it from 'tabs' piece of state\n   */\n\n\n  function handleTabClose(index) {\n    dispatch({\n      type: 'REMOVE_TAB',\n      payload: index\n    });\n    var newTabs = openTabs.filter(function (value, i) {\n      return i !== index;\n    });\n    changeTabs(newTabs);\n  }\n  /**\n   * @function handleClick\n   * @param link\n   * eventHandler helper function that takes the link as a param and returns a component number from matchLink()\n   * if the tab is already open (!indexOf(link) === -1) then switch to that tab with handleTabSwitch\n   * else dispatch a new tab object containing a title, index, and component keys to be appended to 'tabs'...\n   * ...piece of state\n   */\n\n\n  function handleClick(link) {\n    var component = matchLink(link);\n\n    if (openTabs.indexOf(link) === -1) {\n      var newTabContent = {\n        title: link.match(/[A-Z][a-z]+|[0-9]+/g).join(\" \"),\n        index: tabs.length,\n        key: link,\n        component: component\n      };\n      dispatch({\n        type: 'ADD_TAB',\n        payload: newTabContent\n      });\n\n      var newOpen = _toConsumableArray(openTabs);\n\n      newOpen.push(link);\n      changeTabs(newOpen);\n    } else {\n      handleTabSwitch(openTabs.indexOf(link));\n    }\n  }\n  /**\n   * @return\n   * @type Grid\n   * @type Header\n   * @type Tabs\n   * @type Tab\n   * @type MAIN_TABS[component]\n   */\n\n\n  return React.createElement(Grid, {\n    container: true,\n    spacing: 2\n  }, React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    style: {\n      maxWidth: 'min-content',\n      backgroundColor: '#f5f5f5'\n    }\n  }, React.createElement(Tabs, {\n    active: activeTab,\n    onTabSwitch: handleTabSwitch.bind(_this),\n    onTabPositionChange: handleTabPositionChange.bind(_this),\n    onTabClose: handleTabClose.bind(_this),\n    draggable: true,\n    showAdd: false\n  }, //maps 'tabs' piece of state to a <Tab> component, changes when 'tabs' changes\n  tabs.map(function (value, index) {\n    return React.createElement(Tab, {\n      key: value.title + index,\n      title: value.title,\n      showClose: index !== 0\n    }, React.createElement(Grid, {\n      container: true,\n      spacing: 4\n    }, React.createElement(Grid, {\n      item: true,\n      xs: 12\n    }, React.createElement(Header, null)), React.createElement(Grid, {\n      item: true,\n      xs: 12\n    }, createTab(value.key))));\n  }))));\n\n  function createTab(key) {\n    switch (key) {\n      case 'Home':\n        return React.createElement(Home, {\n          onClick: handleClick.bind(this)\n        });\n\n      case 'NewTrade':\n        return React.createElement(NewTrade, {\n          onClick: handleClick\n        });\n\n      case 'Trade':\n        return React.createElement(Trade, null);\n\n      case 'Blotter':\n        return React.createElement(Blotter, null);\n\n      case 'FileNewTrade':\n        return React.createElement(FileUpload, null);\n\n      default:\n        throw new error('Tab Map Failed');\n    }\n  }\n};\n/**\n * @function getInitialProps\n * @param ctx\n * checks if user is already logged in before Main component is mounted, if not redirected to  Login page\n * @return {Promise<boolean|any|Promise<boolean>>}\n */\n\n/* Main.getInitialProps = async ctx => {\n    const { token } = nextCookie(ctx);\n    const apiUrl = getHost(ctx.req) + '/api/profile';\n\n    const redirectOnError = () =>\n        typeof window !== 'undefined'\n            ? Router.push('/Login')\n            : ctx.res.writeHead(302, { Location: '/Login' }).end();\n\n    try {\n        const response = await fetch(apiUrl, {\n            credentials: 'include',\n            headers: {\n                Authorization: JSON.stringify({ token })\n            }\n        });\n\n        if (response.ok) {\n            const js = await response.json()\n            console.log('js', js);\n            return js\n        } else {\n            // https://github.com/developit/unfetch#caveats\n            return await redirectOnError()\n        }\n    } catch (error) {\n        // Implementation or Network error\n        return redirectOnError()\n    }\n};\n\nexport default withAuthSync(Main);\n\n */\n\n\nexport default Main;","map":{"version":3,"sources":["/Users/jjmacakiage/dev/synswap-web-react/synswap/pages/Main.js"],"names":["React","useState","useEffect","useRef","Grid","Tabs","Tab","useDispatch","useSelector","nextCookie","Router","Header","Home","NewTrade","Trade","Blotter","FileUpload","error","axios","withAuthSync","getHost","useInterval","callback","params","delay","setInterval","console","log","Main","blockNumber","state","TradeReducer","initialFetch","url","get","response","dispatch","type","payload","trades","data","blocknumber","fetchTrades","bn","success","notifications","map","trade","message","amount","tradeType","title","counterPartyId","activeTab","TabReducer","tabs","MAIN_TABS","key","component","onClick","handleClick","bind","openTabs","changeTabs","matchLink","link","i","length","Error","handleTabSwitch","active","handleTabPositionChange","a","b","c","handleTabClose","index","newTabs","filter","value","indexOf","newTabContent","match","join","newOpen","push","maxWidth","backgroundColor","createTab"],"mappings":"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","sourcesContent":["import React, {useState, useEffect, useRef} from \"react\";\nimport { Grid } from '@material-ui/core';\nimport Tabs, {Tab} from \"react-awesome-tabs\";\nimport \"../resources/styles/react-awesome-tabs.scss\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport nextCookie from 'next-cookies';\nimport Router from 'next/router';\n\nimport Header from \"../components/main/Header\";\nimport Home from './Home';\nimport NewTrade from './NewTrade';\nimport Trade from './Trade';\nimport Blotter from './Blotter';\nimport FileUpload from './FileUpload';\nimport {error} from \"next/dist/build/output/log\";\nimport axios from \"axios\";\nimport { withAuthSync } from '../utils/Auth/auth';\nimport getHost from '../utils/Auth/get-host';\n\n/**\n * @class Main\n * @constructor\n * Contains all the navigation functions, including the <Tabs /> and their functions (dispatched to reducers/TabReducer)\n * Dependencies used:\n * @react-awesome-tabs for the <Tabs> and <Tab> components, react-awesome-tabs.scss for styling (comes with module)\n * @material-ui for <Grid />\n * @react-redux for useDispatch and useSelector\n * Custom Components used:\n * @class NewTradeContent - New Trade page\n * @class Home - Home page\n * @class Trade - Trade page\n * @class Header - Header\n */\n\nfunction useInterval(callback, params, delay) {\n    useEffect(() => {\n        setInterval(() => {\n            callback(params);\n        }, delay);\n        return (\n            () => {\n                console.log('Component Unmounted');\n            }\n        )\n    }, []);\n}\n\nconst Main = () => {\n    const blockNumber = useSelector(state => state.TradeReducer.blockNumber);\n\n    const initialFetch = async () => {\n        const url = \"http://localhost:4000/api/traders/1/trades\";\n        try {\n            const response = await axios.get(url);\n            dispatch({\n                type: 'INITIAL_FETCH',\n                payload: {trades: response.data.trades,\n                          blocknumber: response.data.blocknumber}\n            });\n\n        } catch (e) {\n            console.log(e);\n        }\n    };\n\n    const fetchTrades = async (bn) => {\n        const url = \"http://localhost:4000/api/updates/\" + bn + \"?traderid=1\";\n        try {\n            const response = await axios.get(url);\n            if(response.data.success && response.data.trades) {\n                dispatch({\n                    type: 'FETCH_TRADES',\n                    payload: {trades: response.data.trades,\n                              blockNumber: response.data.blocknumber}});\n                const notifications = response.data.trades.map((trade) => {\n                    // TODO: Only new trade notifcations currently, currently cannot amend trades.\n                    return {message: \"Amount: \" + trade.amount + \" Type: \" + trade.tradeType, title: \"New trade with \" + trade.counterPartyId +\" alleged\"};\n                });\n                dispatch({\n                    type: 'ADD_NOTIFICATIONS',\n                    payload: notifications\n                })\n            }\n\n        } catch (e) {\n            console.log(e);\n        }\n    };\n\n    useEffect(() => {\n        initialFetch();\n        return;\n    },[]);\n\n    //useInterval(fetchTrades, blockNumber, 5000);\n\n    /**\n     * @constant activeTab\n     * @type {object}\n     * a number that represents the activeTab piece of state\n     */\n    const activeTab = useSelector(state => state.TabReducer.activeTab);\n\n    /**\n     * @var tabs\n     * @type {object}\n     * an array of objects representing the tabs, with each object in the format { title, index, component }\n     */\n    const tabs = useSelector(state => state.TabReducer.tabs);\n\n    /**\n     * @constant dispatch\n     * @type {function}\n     * gives access to dispatch function from Redux store\n     */\n    const dispatch = useDispatch();\n\n    /**\n     * @constant MAIN_TABS\n     * @type {array}\n     * array of objects that contains a 'key' and a 'component' that is mapped to the 'component' attribute from a tab object in....\n     * ....matchLink\n     */\n    const MAIN_TABS= [\n        { key: 'Home', component: Home({ onClick: handleClick.bind(this) }) },\n        { key: 'NewTrade', component: NewTrade({ onClick : handleClick }) },\n        { key: 'Trade', component: Trade() },\n        { key: 'Blotter', component: Blotter() },\n        { key: 'FileNewTrade', component: FileUpload() }\n    ];\n\n    /**\n     * @constant openTabs\n     * @type {array}\n     * used in handleClick method to redirect to a tab if it is already open\n     */\n    const [openTabs, changeTabs] = useState(['Home']);\n\n    /**\n     * @function matchLink\n     * @type string\n     * @param link\n     * helper function that receives a link {string} from an option in the <HomePane />'s (child components of <Home />) and\n     * matches it to a 'component' in the MAIN_TABS array via the 'key'\n     * @return number\n     */\n    function matchLink(link) {\n        for (let i = 0; i < MAIN_TABS.length; i++) {\n            const data = MAIN_TABS[i];\n            if (link === data.key) {\n                return i;\n            }\n        }\n        throw Error('Component Not Found');\n    }\n\n    /**\n     * @function handleTabSwitch\n     * @type number\n     * @type dispatch\n     * @param active\n     * eventHandler helper function that takes the desired tab as a parameter and makes it the new active tab\n     */\n    function handleTabSwitch(active) {\n        dispatch({ type: 'SWITCH_TAB', payload: active});\n    }\n\n    /**\n     * @function handleTabPositionChange\n     * @type dispatch\n     * @param a\n     * @param b\n     * eventHandler helper function that takes the two tabs to be switched around, switches their indices,...\n     * ...and changes the new active tab\n     */\n    function handleTabPositionChange(a, b) {\n        let c = tabs[a];\n        tabs[a] = tabs[b];\n        tabs[b] = c;\n\n        if(activeTab === a) {\n            dispatch({ type: 'SWITCH_TAB', activeTab: b });\n        }else if(activeTab === b) {\n            dispatch({ type: 'SWITCH_TAB', activeTab: a });\n        }\n\n    }\n\n    /**\n     * @function handleTabClose\n     * @param index\n     * eventHandler helper function that takes the closed tab and pops it from 'tabs' piece of state\n     */\n    function handleTabClose(index) {\n        dispatch({ type: 'REMOVE_TAB', payload: index });\n        const newTabs = openTabs.filter((value, i) => {\n            return i !== index;\n        });\n        changeTabs(newTabs)\n    }\n\n    /**\n     * @function handleClick\n     * @param link\n     * eventHandler helper function that takes the link as a param and returns a component number from matchLink()\n     * if the tab is already open (!indexOf(link) === -1) then switch to that tab with handleTabSwitch\n     * else dispatch a new tab object containing a title, index, and component keys to be appended to 'tabs'...\n     * ...piece of state\n     */\n    function handleClick(link) {\n        let component = matchLink(link);\n        if (openTabs.indexOf(link) === -1) {\n            let newTabContent = {\n                title: link.match(/[A-Z][a-z]+|[0-9]+/g).join(\" \"),\n                index: tabs.length,\n                key: link,\n                component: component\n            };\n            dispatch({type: 'ADD_TAB', payload: newTabContent});\n            const newOpen = [...openTabs];\n            newOpen.push(link);\n            changeTabs(newOpen);\n        }\n        else {\n            handleTabSwitch(openTabs.indexOf(link));\n        }\n    }\n    /**\n     * @return\n     * @type Grid\n     * @type Header\n     * @type Tabs\n     * @type Tab\n     * @type MAIN_TABS[component]\n     */\n    return (\n        <Grid container spacing={ 2 }>\n            <Grid item xs={ 12 } style={{ maxWidth: 'min-content', backgroundColor: '#f5f5f5'}}>\n                <Tabs\n                    active={ activeTab }\n                    onTabSwitch={ handleTabSwitch.bind(this) }\n                    onTabPositionChange={ handleTabPositionChange.bind(this) }\n                    onTabClose={ handleTabClose.bind(this) }\n                    draggable={ true }\n                    showAdd={ false }\n                >\n                    {\n                        //maps 'tabs' piece of state to a <Tab> component, changes when 'tabs' changes\n                        tabs.map((value, index) => {\n                            return (\n                                <Tab\n                                    key={ value.title + index }\n                                    title={value.title}\n                                    showClose={ index !== 0 }\n                                >\n                                    <Grid container spacing={ 4 }>\n                                        <Grid item xs={ 12 }>\n                                            <Header />\n                                        </Grid>\n                                        <Grid item xs={ 12 }>\n                                            {\n                                                createTab(value.key)\n                                            }\n                                        </Grid>\n                                    </Grid>\n                                </Tab>\n                            );\n                        })\n                    }\n                </Tabs>\n            </Grid>\n        </Grid>\n    );\n\n    function createTab(key) {\n        switch (key) {\n            case ('Home'):\n                return (\n                    <Home onClick={ handleClick.bind(this) } />\n                );\n            case ('NewTrade'):\n                return (\n                    <NewTrade onClick={ handleClick }/>\n                );\n            case ('Trade'):\n                return (\n                    <Trade />\n                );\n            case ('Blotter'):\n                return (\n                    <Blotter/>\n                );\n            case ('FileNewTrade'):\n                return (\n                    <FileUpload/>\n                );\n            default:\n                throw new error('Tab Map Failed')\n        }\n    }\n\n};\n\n/**\n * @function getInitialProps\n * @param ctx\n * checks if user is already logged in before Main component is mounted, if not redirected to  Login page\n * @return {Promise<boolean|any|Promise<boolean>>}\n */\n\n/* Main.getInitialProps = async ctx => {\n    const { token } = nextCookie(ctx);\n    const apiUrl = getHost(ctx.req) + '/api/profile';\n\n    const redirectOnError = () =>\n        typeof window !== 'undefined'\n            ? Router.push('/Login')\n            : ctx.res.writeHead(302, { Location: '/Login' }).end();\n\n    try {\n        const response = await fetch(apiUrl, {\n            credentials: 'include',\n            headers: {\n                Authorization: JSON.stringify({ token })\n            }\n        });\n\n        if (response.ok) {\n            const js = await response.json()\n            console.log('js', js);\n            return js\n        } else {\n            // https://github.com/developit/unfetch#caveats\n            return await redirectOnError()\n        }\n    } catch (error) {\n        // Implementation or Network error\n        return redirectOnError()\n    }\n};\n\nexport default withAuthSync(Main);\n\n */\nexport default Main;\n"]},"metadata":{},"sourceType":"module"}